---
name: Https test
author: Didi Hoffmann <didi@green-coding.io>
description: A little scenario that compares http and https

compose-file: !include docker-compose.yml

services:
  nginx:
    setup-commands:
      - cp /tmp/repo/https/html/index.html /usr/share/nginx/html/index.html
      - sh /tmp/repo/https/create_file.sh

flow:
  - name: http
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10000`; do curl -s http://nginx; done
        note: Accessing without encryption

  - name: sleep
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: https
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10000`; do curl -s --cacert /certs/nginx.crt https://nginx; done
        note: Accessing with encryption

  - name: sleep2
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: http_options
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10000`; do curl -X OPTIONS -s http://nginx; done
        note: Accessing without encryption

  - name: sleep3
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: https_options
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10000`; do curl -X OPTIONS -s --cacert /certs/nginx.crt https://nginx; done
        note: Accessing with encryption

  - name: sleep4
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: http_large
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10`; do curl -s -o /dev/null  http://nginx/large_file.bin; done
        note: Accessing without encryption

  - name: sleep5
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: https_large
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10`; do curl -s -o /dev/null --cacert /certs/nginx.crt https://nginx/large_file.bin; done
        note: Accessing with encryption

  - name: sleep6
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: sleep 10
        note: A little sleep

  - name: https_weak
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10000`; do curl -s --cacert /certs/nginx_weak.crt https://nginx:442; done
        note: Accessing with encryption

  - name: https_large_weak
    container: curl_client
    commands:
      - type: console
        shell: sh
        command: for i in `seq 1 10`; do curl -s -o /dev/null --cacert /certs/nginx_weak.crt https://nginx:442/large_file.bin; done
        note: Accessing with encryption
